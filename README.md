# Telegram Mini App "Дневник питания"

## Описание проекта

Telegram Mini App "Дневник питания" - это приложение для учета и анализа питания, работающее внутри мессенджера Telegram. Приложение позволяет пользователям делать фотографии еды, получать анализ ее пищевой ценности с помощью искусственного интеллекта, вести дневник питания и отслеживать статистику.

## Возможности приложения

- Распознавание еды по фотографии с использованием OpenAI API
- Анализ питательной ценности блюд (калории, белки, жиры, углеводы)
- Оценка качества питания по шкале от 0 до 100
- Ведение дневника приемов пищи
- Статистика питания по дням
- Интеграция с Telegram WebApp API
- Хранение данных в IndexedDB
- Поддержка светлой и темной темы Telegram

## Архитектура приложения

### Структура проекта

```
testcursor/
├── dist/               # Скомпилированные файлы
├── public/             # Статические файлы
├── src/
│   ├── assets/         # Ресурсы (изображения, иконки)
│   ├── components/     # React компоненты
│   ├── hooks/          # Пользовательские хуки
│   ├── services/       # Сервисы для работы с API и данными
│   ├── types/          # TypeScript типы
│   ├── App.css         # Стили приложения
│   ├── App.tsx         # Основной компонент приложения
│   └── main.tsx        # Точка входа приложения
├── .env                # Переменные окружения
├── .env.example        # Пример переменных окружения
├── eslint.config.js    # Конфигурация ESLint
├── index.html          # HTML шаблон
├── package.json        # Зависимости проекта
├── tsconfig.json       # Конфигурация TypeScript
└── vite.config.ts      # Конфигурация Vite
```

### UML диаграмма компонентов

```
┌─────────────────────────────────────────┐
│                  App                     │
└────────────────┬────────────────────────┘
                 │
     ┌───────────┼───────────────┐
     │           │               │
┌────▼─────┐ ┌───▼────────┐ ┌───▼────────┐
│UserProfile│ │FoodAnalyzer│ │MealHistory │
└────┬─────┘ └─────┬──────┘ └─────┬──────┘
     │             │              │
     └─────────────┼──────────────┘
                   │
           ┌───────▼────────┐
           │useNutritionStorage│
           └─────────┬──────┘
                     │
               ┌─────▼─────┐
               │nutritionDB│
               └───────────┘
```

### UML диаграмма классов

```
┌───────────────────────────┐       ┌────────────────────────┐
│      NutritionDatabase    │       │     FoodAnalysis       │
├───────────────────────────┤       ├────────────────────────┤
│- dbPromise: Promise<IDB>  │       │+ name: string          │
├───────────────────────────┤       │+ calories: number      │
│+ addMeal(meal: Meal)      │       │+ protein: number       │
│+ getMeals(userId, date)   │ uses  │+ fats: number          │
│+ getDailyNutrition(userId)│◄──────│+ carbs: number         │
│+ getHistory(userId)       │       │+ healthScore: number   │
│+ clearHistory(userId)     │       │+ commentary?: string   │
└───────────────────────────┘       └────────────────────────┘
          ▲                                      ▲
          │                                      │
          │ extends                              │ uses
          │                                      │
┌─────────────────────────┐             ┌────────────────────┐
│    InternalDailyNutrition │             │        Meal        │
├─────────────────────────┤             ├────────────────────┤
│+ key: string            │             │+ id: string        │
└─────────────────────────┘             │+ userId: number    │
          ▲                             │+ timestamp: number │
          │                             │+ type: MealType    │
          │ extends                     │+ foods: FoodAnalysis[]│
          │                             │+ photo?: string    │
┌─────────────────────────┐             │+ totalCalories: number│
│     DailyNutrition      │◄────────────│+ totalProtein: number│
├─────────────────────────┤   contains  │+ totalFats: number │
│+ date: string           │             │+ totalCarbs: number│
│+ userId: number         │             │+ healthScore: number│
│+ meals: Meal[]          │             └────────────────────┘
│+ totalCalories: number  │
│+ totalProtein: number   │
│+ totalFats: number      │
│+ totalCarbs: number     │
│+ averageHealthScore: number│
└─────────────────────────┘
```

### UML диаграмма потока данных

```
┌──────────────┐      ┌───────────────┐      ┌─────────────────┐
│  User Camera │      │ FoodAnalyzer  │      │ OpenAI API /    │
│  (Telegram)  │─────►│ Component     │─────►│ Mock Service    │
└──────────────┘      └───────┬───────┘      └────────┬────────┘
                              │                       │
                              ▼                       ▼
                      ┌───────────────┐      ┌─────────────────┐
                      │  Nutrition    │      │ FoodAnalysis    │
                      │  Storage Hook │◄─────│ Result          │
                      └───────┬───────┘      └─────────────────┘
                              │
                              ▼
                      ┌───────────────┐
                      │  IndexedDB    │
                      │  Database     │
                      └───────┬───────┘
                              │
                  ┌───────────┴───────────┐
                  │                       │
                  ▼                       ▼
          ┌───────────────┐      ┌─────────────────┐
          │ User Profile  │      │  Meal History   │
          │ Statistics    │      │  Component      │
          └───────────────┘      └─────────────────┘
```

## Ключевые компоненты

### App.tsx
Основной компонент приложения, отвечающий за:
- Инициализацию Telegram Web App API
- Управление вкладками интерфейса
- Применение темы Telegram к приложению

### FoodAnalyzer.tsx
Компонент для анализа фотографий еды:
- Выбор фотографии из камеры или галереи
- Отправка фото на анализ в OpenAI API
- Отображение результатов анализа
- Сохранение данных о приеме пищи

### MealHistory.tsx
Компонент для отображения истории питания:
- Просмотр статистики по дням
- Отображение списка приемов пищи
- Детальная информация о каждом блюде
- Обновление и сортировка данных

### UserProfile.tsx
Компонент для отображения профиля пользователя:
- Данные пользователя из Telegram
- Статистика использования приложения
- Управление базой данных
- Очистка истории питания

## Сервисы и хуки

### useTelegram.ts
Хук для взаимодействия с Telegram WebApp API:
- Получение данных пользователя
- Доступ к функциям Telegram
- Отслеживание темы и других параметров

### useChatGPTFoodAnalysis.ts
Хук для анализа пищи с помощью OpenAI API:
- Отправка фотографий в API OpenAI
- Обработка результатов анализа
- Режим имитации для работы в Telegram WebApp

### useNutritionStorage.ts
Хук для управления хранилищем данных о питании:
- Абстракция над IndexedDB
- Добавление и получение данных
- Управление состоянием загрузки и ошибками

### database.ts
Сервис для работы с IndexedDB:
- Инициализация базы данных
- CRUD операции для приемов пищи
- Управление дневной статистикой

## Типы данных

### Meal
Представляет прием пищи:
- Уникальный идентификатор
- Временная метка
- Тип приема пищи (завтрак, обед, ужин, перекус)
- Список продуктов и блюд
- Общая питательная ценность

### FoodAnalysis
Представляет результат анализа пищи:
- Название блюда
- Калории, белки, жиры, углеводы
- Оценка качества питания
- Комментарий о полезности

### DailyNutrition
Представляет статистику питания за день:
- Дата
- Идентификатор пользователя
- Список приемов пищи
- Общая статистика за день

## Использование IndexedDB

Приложение использует IndexedDB для надежного хранения данных о питании:
- Хранилище `meals` для отдельных приемов пищи
- Хранилище `dailyNutrition` для дневной статистики
- Индексы для быстрого поиска по пользователю и дате

## API и интеграции

### Telegram Web App API
Используется для:
- Получения данных пользователя
- Доступа к функциям Telegram
- Применения темы Telegram к приложению

### OpenAI API
Используется для:
- Анализа фотографий еды
- Определения питательной ценности блюд
- Расчета оценки качества питания

## Настройка проекта

### Переменные окружения
Приложение использует следующие переменные окружения:
- `VITE_OPENAI_API_KEY` - API ключ для доступа к OpenAI API

### Установка и запуск

```bash
# Установка зависимостей
npm install

# Запуск в режиме разработки
npm run dev

# Сборка для продакшн
npm run build

# Предпросмотр собранного приложения
npm run preview
```

## Особенности реализации

### Работа в Telegram Mini App
В Telegram WebApp действуют ограничения CORS, поэтому:
- Для анализа фото в Telegram используется режим имитации
- Вне Telegram используется прямой доступ к OpenAI API

### Хранение данных
- Данные хранятся в IndexedDB для надежности и производительности
- Приложение работает офлайн после первой загрузки
- Данные привязаны к конкретному пользователю Telegram

### Адаптивный дизайн
- Интерфейс адаптируется под темную и светлую тему Telegram
- Использует UI-компоненты в стиле Telegram
- Корректно работает на различных размерах экрана

## Будущие улучшения

1. **Синхронизация с облаком**: Добавление возможности синхронизации данных между устройствами
2. **Расширенная аналитика**: Графики и отчеты о питании за различные периоды
3. **Сканирование штрих-кодов**: Добавление продуктов по штрих-коду
4. **Рекомендации**: Персонализированные рекомендации по улучшению питания
5. **Экспорт данных**: Возможность экспорта истории питания в различных форматах

## Разработчик

Проект разработан как Telegram Mini App с использованием современных веб-технологий.
